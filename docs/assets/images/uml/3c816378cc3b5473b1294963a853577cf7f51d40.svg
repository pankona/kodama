<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1274px" preserveAspectRatio="none" style="width:880px;height:1274px;" version="1.1" viewBox="0 0 880 1274" width="880px" zoomAndPan="magnify"><defs><filter height="300%" id="fgs0lmux5461a" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="1252" style="stroke: #383838; stroke-width: 1.0;" width="380" x="351" y="4"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="453" y="21.5977">Async Job System</text><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="55" x2="55" y1="67" y2="1262"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="155" x2="155" y1="67" y2="1262"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="419" x2="419" y1="67" y2="1262"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="552.5" x2="552.5" y1="67" y2="1262"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="707" x2="707" y1="67" y2="1262"/><rect fill="#F8F8F8" filter="url(#fgs0lmux5461a)" height="34" style="stroke: #383838; stroke-width: 1.5;" width="91" x="8" y="28"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="15" y="52.5977">Web App</text><rect fill="#F8F8F8" filter="url(#fgs0lmux5461a)" height="34" style="stroke: #383838; stroke-width: 1.5;" width="80" x="113" y="28"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="120" y="52.5977">Worker</text><rect fill="#F8F8F8" filter="url(#fgs0lmux5461a)" height="34" style="stroke: #383838; stroke-width: 1.5;" width="124" x="355" y="28"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="362" y="52.5977">API Server</text><rect fill="#F8F8F8" filter="url(#fgs0lmux5461a)" height="34" style="stroke: #383838; stroke-width: 1.5;" width="113" x="494.5" y="28"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="501.5" y="52.5977">Job Queue</text><rect fill="#F8F8F8" filter="url(#fgs0lmux5461a)" height="34" style="stroke: #383838; stroke-width: 1.5;" width="36" x="687" y="28"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="694" y="52.5977">DB</text><rect fill="#EEEEEE" filter="url(#fgs0lmux5461a)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="865" x="3" y="100"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="868" y1="100" y2="100"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="868" y1="103" y2="103"/><rect fill="#EEEEEE" filter="url(#fgs0lmux5461a)" height="28" style="stroke: #000000; stroke-width: 2.0;" width="157" x="357" y="87"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="363" y="108.5977">Register Job</text><polygon fill="#383838" points="407,147,417,151,407,155,411,151" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="55.5" x2="413" y1="151" y2="151"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="80" x="62.5" y="146.5977">Register</text><polygon fill="#383838" points="541,181,551,185,541,189,545,185" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="419" x2="547" y1="185" y2="185"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="80" x="426" y="180.5977">Register</text><polygon fill="#383838" points="695,235,705,239,695,243,699,239" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="553" x2="701" y1="239" y2="239"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="560" y="214.5977">Insert</text><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="70" x="560" y="234.5977">new Job</text><polygon fill="#383838" points="564,269,554,273,564,277,560,273" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="558" x2="706" y1="273" y2="273"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="570" y="268.5977">Job ID</text><polygon fill="#383838" points="430,303,420,307,430,311,426,307" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="552" y1="307" y2="307"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="436" y="302.5977">Job ID</text><polygon fill="#383838" points="66.5,337,56.5,341,66.5,345,62.5,341" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="60.5" x2="418" y1="341" y2="341"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="72.5" y="336.5977">Job ID</text><rect fill="#EEEEEE" filter="url(#fgs0lmux5461a)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="865" x="3" y="372"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="868" y1="372" y2="372"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="868" y1="375" y2="375"/><rect fill="#EEEEEE" filter="url(#fgs0lmux5461a)" height="28" style="stroke: #000000; stroke-width: 2.0;" width="146" x="362.5" y="359"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="368.5" y="380.5977">Execute Job</text><polygon fill="#383838" points="407,419,417,423,407,427,411,423" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="155" x2="413" y1="423" y2="423"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="50" x="162" y="418.5977">Fetch</text><polygon fill="#383838" points="541,453,551,457,541,461,545,457" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="419" x2="547" y1="457" y2="457"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="50" x="426" y="452.5977">Fetch</text><polygon fill="#383838" points="695,507,705,511,695,515,699,511" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="553" x2="701" y1="511" y2="511"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="560" y="486.5977">Select</text><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="110" x="560" y="506.5977">Pending Job</text><polygon fill="#383838" points="564,541,554,545,564,549,560,545" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="558" x2="706" y1="545" y2="545"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="110" x="570" y="540.5977">Pending Job</text><polygon fill="#383838" points="430,575,420,579,430,583,426,579" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="552" y1="579" y2="579"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="110" x="436" y="574.5977">Pending Job</text><polygon fill="#383838" points="166,609,156,613,166,617,162,613" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="160" x2="418" y1="613" y2="613"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="110" x="172" y="608.5977">Pending Job</text><line style="stroke: #383838; stroke-width: 1.0;" x1="155" x2="197" y1="647" y2="647"/><line style="stroke: #383838; stroke-width: 1.0;" x1="197" x2="197" y1="647" y2="660"/><line style="stroke: #383838; stroke-width: 1.0;" x1="156" x2="197" y1="660" y2="660"/><polygon fill="#383838" points="166,656,156,660,166,664,162,660" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="110" x="162" y="642.5977">Execute Job</text><path d="M160,673 L160,703 L421,703 L421,683 L411,673 L160,673 " fill="#ECECEC" filter="url(#fgs0lmux5461a)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M411,673 L411,683 L421,683 L411,673 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="240" x="166" y="695.5977">It may take long time...</text><polygon fill="#383838" points="407,734,417,738,407,742,411,738" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="155" x2="413" y1="738" y2="738"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="240" x="162" y="733.5977">Update (success/failure)</text><polygon fill="#383838" points="541,768,551,772,541,776,545,772" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="419" x2="547" y1="772" y2="772"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="426" y="767.5977">update</text><path d="M558,785 L558,875 L859,875 L859,795 L849,785 L558,785 " fill="#ECECEC" filter="url(#fgs0lmux5461a)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M849,785 L849,795 L859,795 L849,785 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="280" x="564" y="807.5977">if job executing was failure</text><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="230" x="564" y="827.5977">and retry count doesn't</text><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="280" x="564" y="847.5977">exceed as configured, change</text><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="230" x="564" y="867.5977">job status to "Pending"</text><polygon fill="#383838" points="695,926,705,930,695,934,699,930" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="553" x2="701" y1="930" y2="930"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="560" y="905.5977">Update</text><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="100" x="560" y="925.5977">Job status</text><polygon fill="#383838" points="564,940,554,944,564,948,560,944" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="558" x2="706" y1="944" y2="944"/><polygon fill="#383838" points="430,954,420,958,430,962,426,958" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="552" y1="958" y2="958"/><polygon fill="#383838" points="166,968,156,972,166,976,162,972" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="160" x2="418" y1="972" y2="972"/><rect fill="#EEEEEE" filter="url(#fgs0lmux5461a)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="865" x="3" y="1003"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="868" y1="1003" y2="1003"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="868" y1="1006" y2="1006"/><rect fill="#EEEEEE" filter="url(#fgs0lmux5461a)" height="28" style="stroke: #000000; stroke-width: 2.0;" width="223" x="324" y="990"/><text fill="#000000" font-family="courier" font-size="20" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="330" y="1011.5977">Confirm Job Status</text><polygon fill="#383838" points="407,1050,417,1054,407,1058,411,1054" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="55.5" x2="413" y1="1054" y2="1054"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="62.5" y="1049.5977">Status</text><polygon fill="#383838" points="541,1084,551,1088,541,1092,545,1088" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="419" x2="547" y1="1088" y2="1088"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="426" y="1083.5977">Status</text><polygon fill="#383838" points="695,1138,705,1142,695,1146,699,1142" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="553" x2="701" y1="1142" y2="1142"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="60" x="560" y="1117.5977">Select</text><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="130" x="560" y="1137.5977">Specified Job</text><polygon fill="#383838" points="564,1172,554,1176,564,1180,560,1176" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="558" x2="706" y1="1176" y2="1176"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="30" x="570" y="1171.5977">Job</text><polygon fill="#383838" points="430,1206,420,1210,430,1214,426,1210" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="552" y1="1210" y2="1210"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="30" x="436" y="1205.5977">Job</text><polygon fill="#383838" points="66.5,1240,56.5,1244,66.5,1248,62.5,1244" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="60.5" x2="418" y1="1244" y2="1244"/><text fill="#000000" font-family="courier" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="30" x="72.5" y="1239.5977">Job</text><!--
@startuml

skinparam monochrome true
skinparam defaultFontSize 20
skinparam defaultFontName courier

hide footbox

participant "**Web App**"    as app
participant "**Worker**"     as worker
box "Async Job System"
participant "**API Server**" as api
participant "**Job Queue**"  as queue
participant "**DB**"         as db
end box

== Register Job ==

app -> api : Register
    api -> queue : Register
        queue -> db : Insert\nnew Job
        queue <- - db : Job ID
    api <- - queue : Job ID
app <- - api : Job ID

== Execute Job ==

api <- worker : Fetch
    api -> queue : Fetch
        queue -> db : Select\nPending Job
        queue <- - db : Pending Job
    api <- - queue : Pending Job
api - -> worker : Pending Job

worker -> worker : Execute Job
note right of worker : It may take long time...

api <- worker : Update (success/failure)
    api -> queue : update
        note right of queue: if job executing was failure\nand retry count doesn't\nexceed as configured, change\njob status to "Pending"
        queue -> db : Update\nJob status
        queue <- - db
    api <- - queue
api - -> worker

== Confirm Job Status ==

app -> api : Status
    api -> queue : Status
        queue -> db : Select\nSpecified Job
        queue <- - db : Job
    api <- - queue : Job
app <- - api : Job

@enduml

PlantUML version 1.2018.02(Sat Mar 10 02:20:44 JST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_192-b26
Operating System: Linux
OS Version: 4.12.14-1-MANJARO
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>